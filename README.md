# land-tasker-frontend react deployment pipeline with AWS CodePipeline and AWS CodeBuild
This is a deployment pipeline for my P3 project - landtasker website front end. It allows you to connect to an existing github account and use AWS CodePipeline and AWS CodeBuild to deploy your code to an S3 static website. The pipeline will react to any push to your selected github project and branch and will deploy the app to the static bucket. 
Alternatively, you can use the more advanced template to also provision a custom domain, a CloudFront distribution and an SSL certificate for your app.
# The steps below describe how to set up the pipeline manually (no IaC like CloudFormation)
1. Set up two S3 buckets. One for building artifact storage and the other one for hosting static website. Uncheck block public access for deployment bucket so the site can be public & enable static website hosting (under property setting).
Also set up bucket policy you can find from this repo. "deploy-bucket-policy.json" - if you want to configure this pipeline manually this is the bucket policy for your deploy bucket. Please replace the bucket ARN with your own bucket ARN.
2. Go to CodePipeline. Create a new pipeline. Go to advance setting, customer location chooses S3 bucket for building artifact storage. In source provider and enable connection. And choose the repo and branch name. 
3. In Build stage: Choose "codebuild" in Build Provider. Create a new project, choose image (I use Ubuntu) and set up a new service role (this will be created automatically). Set up "Buildspec" Yaml: either choose "use a build spec file", which should be stored in src folder in the repo or "insert build commands". The code is stored in this repo under "codebuild-build-commands". This file does the npm install/build and specify the artifact for build stage. 
4. Next is to add deploy stage. Choose deploy provider, specify the deploy provider as Amazon S3 and choose the S3 deplpyment bucket set up in the previous stage. 
5. Go to IAM and roles. Go to the CodePipeline service role that was set up for us during the above process, and update the policy attached from Json. The updated policy will be stored in this repo under "role-policy", this is to assign the right permissions for the 2 S3 buckets. Do the same thing for the other role for "CodeBuild".
6. Go back to CodePipeline and click "release change". The pipeline should be deployed successfully. Go to deployment bucket, under "property", you can find the url in static website hosting. Paste the url in web browser and you should be able to visit the site. 
7. To test the pipeline, go to code editor and made any changes in the repo and commit and push the changes, it should trigger the pipeline and the website should be updated. 

#The below steps is for more complex set up using Cloudfront and Route53. 
1. Go to "certificate manager". Add domain name, this should be the same as the website. Use DNS validation. Because my domain is hosted in route53, I can simply validate it by going to "create record in Route 53". Note that certificate is only available in Virginia region.
2. Go to Cloudfront, create "Distribution", the origin domain is S3, so choose the deployment bucket in dropdown. In viewer, choose "direct HTTP to HTTPS", choose the certificate created in the above step. In "Alternate domain name (CNAME), type in the customer domain (should be the same as certificate manager). Default root object should be "index.html". Then create distribution, this will take a while. 
3. While the site is being distributed, go to Route53, choose the domain where you want to host the website. Go to "create a new record" to add record name for the subdomain for the website. Under "Route traffic to (Alias), choose "Alias to CloudFront distribution" and choose the distribution created in step 1. 
4. Copy the https url from Route53 and paste in brower, the website should work. 
